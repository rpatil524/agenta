@host = http://localhost
@token = replace-me
@base_url = {{host}}/api/preview/tools

###
# @name create_account
POST {{host}}/api/admin/account
Content-Type: application/json
Authorization: Access {{token}}

{
  "user": {
    "name": "test_user",
    "email": "test@agenta.ai"
  },
  "scope": {
    "name": "Agenta (test)"
  }
}

###
@authorization = {{create_account.response.body.scopes[0].credentials}}

# =====================================================================
# CONNECTION CRUD (REST-style)
# =====================================================================

###
# --- Step 1: Create a connection (initiates OAuth flow) ---

# @name create_connection
POST {{base_url}}/catalog/providers/composio/integrations/gmail/connections
Content-Type: application/json
Authorization: {{authorization}}

{
  "slug": "my-gmail",
  "name": "My Gmail Account",
  "description": "Personal Gmail for testing"
}

###
@connection_slug = {{create_connection.response.body.connection.slug}}
@redirect_url = {{create_connection.response.body.redirect_url}}

###
# --- Step 2: Open redirect_url in browser to complete OAuth ---
# After completing OAuth, the callback will update the connection.
# Then poll the connection to check status:

# @name get_connection
GET {{base_url}}/catalog/providers/composio/integrations/gmail/connections/{{connection_slug}}
Authorization: {{authorization}}

###
# --- Step 3: Refresh connection (re-validate / get new tokens) ---

# @name refresh_connection
POST {{base_url}}/catalog/providers/composio/integrations/gmail/connections/{{connection_slug}}/refresh
Content-Type: application/json
Authorization: {{authorization}}

{
  "force": false
}

###
# --- Step 4: List all connections for this integration ---

# @name list_connections
GET {{base_url}}/catalog/providers/composio/integrations/gmail/connections
Authorization: {{authorization}}

###
# --- Step 5: Delete connection ---
# WARNING: This permanently revokes the connection at the provider

# @name delete_connection
DELETE {{base_url}}/catalog/providers/composio/integrations/gmail/connections/{{connection_slug}}
Authorization: {{authorization}}


# =====================================================================
# SLUG-BASED CONNECT (shorthand)
# =====================================================================

###
# @name slug_connect
# Create connection using slug-based endpoint
POST {{base_url}}/connect
Content-Type: application/json
Authorization: {{authorization}}

{
  "slug": "tools.composio.github.my-github",
  "name": "My GitHub Account"
}

###
@github_slug = {{slug_connect.response.body.connection.slug}}
@github_redirect = {{slug_connect.response.body.redirect_url}}

###
# @name slug_refresh
# Refresh connection using slug-based endpoint
POST {{base_url}}/refresh
Content-Type: application/json
Authorization: {{authorization}}

{
  "slug": "tools.composio.github.CREATE_ISSUE.my-github",
  "force": false
}
